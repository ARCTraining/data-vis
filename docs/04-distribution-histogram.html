<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>distribution-histogram</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="04-distribution-histogram_files/libs/clipboard/clipboard.min.js"></script>
<script src="04-distribution-histogram_files/libs/quarto-html/quarto.js"></script>
<script src="04-distribution-histogram_files/libs/quarto-html/popper.min.js"></script>
<script src="04-distribution-histogram_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="04-distribution-histogram_files/libs/quarto-html/anchor.min.js"></script>
<link href="04-distribution-histogram_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="04-distribution-histogram_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="04-distribution-histogram_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="04-distribution-histogram_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="04-distribution-histogram_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="assessing-distributions-histograms" class="level1">
<h1>Assessing distributions: histograms</h1>
<p>In the last session, we used the seaborn library to apply some aesthetic changes to our plots, including sizing, colour palette, and adding a background grid. In this session, we are going to take this further and work with seaborn directly to build the plot.</p>
<p>While we build our plots, we will also be thinking about the idea of “chartjunk” and how plots can be made too busy and difficult to understand by either adding unnecessary aesthetic flourishes like patterns and colours, or by trying to cram too much data into a single plot. Different people have different tolerance limits for “chartjunk”—keep an eye out to see where your limit lies as we progressively add more and more junk to our plots.</p>
<p>```wzfasltisygt Using seaborn :class: dropdown</p>
<p>Seaborn is a library for data visualisation built on top of matplotlib.</p>
<p>From the <a href="https://seaborn.pydata.org/">seaborn homepage</a>: &gt; It provides a high-level interface for drawing attractive and informative statistical graphics.</p>
<p>Seaborn provides you with a selection of templates for frequently used statistical plots. This allows you to quickly produce common plot types in very few lines of code, without building them from scratch in matplotlib.</p>
<p>However, you can also tweak things using matplotlib functions, but sometimes there may be conflicts in the background which could lead to unexpected behaviour.</p>
<p>In general: - If you need a plot that matches the structure of one in the <a href="https://seaborn.pydata.org/examples/index.html">seaborn gallery</a>, this library will allow you to rapidly build this. - If you want complete aesthetic control over your plots, including irregularly gridded panels, overlaid plots etc., then either seaborn + matplotlib, or pure matplotlib will let you achieve this.</p>
<pre><code>
For this session, we will be using a histogram to display a distribution. Again, we are going to be generating random data.

In the previous session, we generated data stored using numpy and stored them in `np.array` objects, assigned to variables, like this:

```python
# create example random data
time = np.arange(10)
signal_1 = np.random.rand(10)
signal_2 = np.random.rand(10)
signal_3 = np.random.rand(10)</code></pre>
<p>In this session, we are going to do similar, except instead of storing each array of random numbers as a different variable, we are going to put them all together in a <em>dataframe</em> using the library <em>pandas</em>. Additionally, instead of using the <code>np.random.rand()</code> function, we are going to use the <code>np.random.randn()</code> function - spot the difference! Read the docs <a href="https://numpy.org/doc/stable/reference/random/generated/numpy.random.randn.html">here</a>.</p>
<p>```wzfasltisygt Pandas dataframe :class: tip</p>
<p>According to the pandas documentation, a dataframe is a: &gt; Two-dimensional, size-mutable, potentially heterogeneous tabular data.</p>
<ul>
<li>A dataframe is a table that can contain different <em>types</em> of data</li>
<li>It is very similar to a spreadsheet with different columns and rows</li>
<li>Individual cells of this “spreadsheet” can contain lists, arrays, strings etc.</li>
<li>Arithmetic operations can be applied to rows or columns</li>
</ul>
<pre><code>
## Using pandas in colab

Lets start by importing all the libraries that we are going to use:

```python
# Importing necessary libraries
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
import pandas as pd</code></pre>
<p>Pandas library generally takes the alias <code>pd</code>.</p>
<p>If we want to compare two different random distributions, we could assign them to variables as we did in the previous session:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create example random data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>distribution_1 <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>distribution_2 <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This code will create two arrays of pseudo-random normally distributed numbers, assigned to the variables <code>distribution_1</code> and <code>distribution_2</code>. However, we can instead stick these in a <code>dataframe</code> using pandas. Replacing the above lines of code, we get:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create example random data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>distribution_1 <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>distribution_2 <span class="op">=</span> np.random.randn(<span class="dv">100</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sample dataframe</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.DataFrame({<span class="st">'Dist 1'</span>: distribution_1,  <span class="co"># pre-defined variable</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Dist 2'</span>: distribution_2,  <span class="co"># pre-defined variable</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Dist 3'</span>: np.random.randn(<span class="dv">100</span>)})  <span class="co"># defined on-the-fly</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can see from this snippet, you can either pre-define variables (<code>distribution_1</code> and <code>distribution_2</code>) and then insert them into the code, or define them in-place inside the dataframe.</p>
<p>``<code>wzfasltisygt What's going on with the curly brackets inside the dataframe? :class: dropdown A dataframe takes data in the form of a</code>dictionary<code>, which is surrounded by curly brackets</code><code>, and contains string</code>keys` or labels for the data, followed by a colon and then the data.</p>
<p>A dictionary generally looks like this:</p>
<p><code>example_dict = {"Key 1" : [0, 1, 2, 3, 5], "Key 2" : np.array([10, 20, 30, 40])}</code></p>
<p>As you can see from the above example, <code>dicts</code> can take different <em>types</em> of data, including lists and numpy arrays.</p>
<p>In the case of using this with pandas, the <code>dict</code> object essentially defines the column headers (the <code>keys</code>), and the column values (the list or array of numbers).</p>
<pre><code>
We now have a table called `data` that contains `'Dist 1'`, `'Dist 2'` and `'Dist 3'`. As you practise using pandas (and Python in general), you will get much more familiar with these data types, and much more comfortable with using them. However, when you first start, it can feel like a big leap moving from using a visible spreadsheet such as an Excel workbook, where you can see your data arranged in a table, to using something like pandas where it is "hidden". However, when working with manageably-sized data frames, we can visualise them using a number of tools that are available working with Google Colab (and other Jupyter-notebook tools).

One of the simplest ways is just by using the variable viewer in the left panel in colab:

|![image](figs/dat_exp.png) | 
|:--| 
| Caption *Alt text: here* |

|![image](figs/data_exp2.png) | 
|:--| 
| Caption *Alt text: here* |

This allows a quick preview of the dataframe and is useful for basic checks (e.g. that the values look sensible).

For more extensibility, you can use Colab's [data table display tool](https://colab.research.google.com/notebooks/data_table.ipynb) to render data tables.
In order to use this for our newly created dataframe, add these lines to your import statements and re-run that cell:

```python
# data table view
from google.colab import data_table
data_table.enable_dataframe_formatter()</code></pre>
<p>Then, in a cell below where you define the dataframe <code>data</code>, call the dataframe by simply running:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also turn off this functionality (if it starts to get in your way!) by running:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>data_table.disable_dataframe_formatter()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="plotting-with-seaborn-and-pandas" class="level2">
<h2 class="anchored" data-anchor-id="plotting-with-seaborn-and-pandas">Plotting with seaborn and pandas</h2>
<p>Now that we’ve created our example data, we can start plotting it. Seaborn is built to work well with pandas dataframes; they integrate very tidily. We’re going to start by just focusing on <code>"Dist 1"</code>, the first random array stored in our dataframe <code>data</code>. We can create a bare-bones plot by setting up the <code>fig</code> and <code>ax</code> as we have done previously, then calling the seaborn <code>histplot</code> function. Unlike when we were using matplotlib, we don’t prefix <code>histplot</code> with <code>ax</code> (like <code>ax.plot</code>); instead, we pass <code>histplot</code> the argument <code>ax=</code>. We’ve called our axes “ax”, so we get the slightly silly looking argument <code>ax=ax</code>. We will see later in the course how this becomes more relevant when you have a multi-part figure!</p>
<pre><code># Create a figure and axes
fig, ax = plt.subplots()

# plot the histogram
sns.histplot(data, x="Dist 1", ax=ax)</code></pre>
<p>We can apply all the aesthetic options provided by seaborn to make this more visually appealing:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default seaborn theme</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># change the style of the plot</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"white"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># set the "context" of the plot</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">"paper"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axes</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a overlaid histogram with a kde line</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>sns.histplot(data, x<span class="op">=</span><span class="st">"Dist 1"</span>, kde<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># get rid of top and right spines</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the above example, we have added an argument to the histplot function: <code>kde=True</code>. Have a look at the <a href="https://seaborn.pydata.org/generated/seaborn.histplot.html"><code>histplot</code> documentation</a> to see what this does:</p>
<blockquote class="blockquote">
<p>Compute a kernel density estimate to smooth the distribution and show on the plot as (one or more) line(s).</p>
</blockquote>
<p>Seaborn makes applying and visualising statistical methods such as <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation">KDE</a> rapid and straightforward. Of course, a potential drawback is that because statistical methods can be applied so easily with default choices hidden behind the scenes, it can be easy to choose options without understanding the underlying mathematics or whether it is a sensible choice for your data. Make sure to read through the <code>api</code> or docs before you choose a plot that you want to build, to make sure it is a sensible choice for your research. Discuss this with your colleagues/cohort/collaborators/supervisors if you’re not sure.</p>
<section id="plotting-multiple-distributions" class="level3">
<h3 class="anchored" data-anchor-id="plotting-multiple-distributions">Plotting multiple distributions</h3>
<p>But our dataframe <code>data</code> contains multiple distributions. What if we want to plot all three? The <code>histplot</code> function has a default argument ready to go in case you add multiple data series to plot: <code>multiple = layer</code>. We can plot the entire dataframe by simply removing the argument <code>x='Dist 1'</code> from the <code>histplot</code> function call:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># default seaborn theme</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>sns.set_theme()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># change the style of the plot</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"white"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># set the "context" of the plot</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">"paper"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a figure and axes</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a overlaid histogram with a line</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>sns.histplot(data, kde<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># get rid of top and right spines</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Show plot</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You should have a figure that looks something like this:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"><img src="figs/hist_first.png" class="img-fluid" alt="image"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Caption <em>Alt text: here</em></td>
</tr>
</tbody>
</table>
<p>We can all agree that this is probably not the best way of viewing this data.</p>
<p>We are going to have a look at two different arguments that <code>histplot</code> can take that will help us control the appearance of our plot: <code>multiple</code> and <code>element</code>.</p>
<table class="table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Argument</th>
<th style="text-align: left;"><code>multiple</code></th>
<th style="text-align: left;"><code>element</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">Default value</td>
<td style="text-align: left;"><code>layer</code></td>
<td style="text-align: left;"><code>bars</code></td>
</tr>
<tr class="even">
<td style="text-align: right;">Options</td>
<td style="text-align: left;"><code>“layer”, “dodge”, “stack”, “fill”</code></td>
<td style="text-align: left;"><code>“bars”, “step”, “poly”</code></td>
</tr>
</tbody>
</table>
<p>In order to understand what these arguments do, try to recreate the following plots (the answer is in the drop-down menu, but try to figure it out yourself through trial and error!). Remember your data will be different so they won’t look identical.</p>
<table class="table">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><img src="figs/hist_challenge1.png" class="img-fluid" alt="image"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Challenge plot #1. What are some potential issues with this plot? <em>Alt text: here</em></td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;"><img src="figs/hist_challenge2.png" class="img-fluid" alt="image"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Challenge plot #2. Is this plot easy to interpret? <em>Alt text: here</em></td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><img src="figs/hist_challenge3.png" class="img-fluid" alt="image"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Challenge plot #2. A truly awful plot, to show you that just because you can choose and option in seaborn, doesn’t mean it’s sensible. This one has an extra challenge… hint: you’ll need to change the <code>fill</code> argument. <em>Alt text: here</em></td>
</tr>
</tbody>
</table>
<p>```wzfasltisygt Challenge solutions :class: dropdown</p>
<p>Challenge plot one: <code>sns.histplot(data, kde=True, multiple="stack", element="step", ax=ax)</code></p>
<p>Challenge plot two: <code>sns.histplot(data, kde=True, multiple="dodge", element="bars", ax=ax)</code></p>
<p>Challenge plot three: <code>sns.histplot(data, kde=True, multiple="layer", element="step", fill=False, ax=ax)</code></p>
<p>```</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>